---
import PublicLayout from '../layouts/PublicLayout.astro';
import PokemonShowcase from '../components/PokemonShowcase.astro';
import SignInButton from '../components/SignInButton';
import Footer from '../components/Footer.astro';

// Check if user is already authenticated
const { supabase } = Astro.locals;
const {
  data: { session },
} = await supabase.auth.getSession();

// Redirect authenticated users to dashboard
if (session) {
  return Astro.redirect('/dashboard', 302);
}
---

<PublicLayout
  title="Pok√©Math - Learn Math, Catch Pok√©mon!"
  description="Master your math skills through exciting battles. Answer questions correctly to catch and collect Pok√©mon from Generation 1."
>
  <!-- Hero Section -->
  <section
    class="relative flex min-h-screen flex-col items-center justify-center overflow-hidden px-2 py-8 sm:px-4 sm:py-12"
  >
    <!-- Background Image -->
    <div
      class="absolute inset-0 bg-cover bg-center bg-no-repeat opacity-85"
      style="background-image: var(--dashboard-bg-image, url('/dashboard_background_day.jpg'));"
    >
    </div>

    <!-- Dark overlay for better text readability -->
    <div
      class="absolute inset-0"
      style="background: linear-gradient(to bottom, rgba(10, 22, 40, 0.5) 0%, rgba(10, 22, 40, 0.65) 100%);"
    >
    </div>

    <!-- Animated background grid -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden opacity-20">
      <div class="grid-pattern"></div>
    </div>

    <!-- Light beams -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="light-beam beam-1"></div>
      <div class="light-beam beam-2"></div>
      <div class="light-beam beam-3"></div>
    </div>

    <!-- Floating orbs for depth -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
    </div>

    <!-- Floating emoji particles -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="emoji-particle" style="left: 10%; animation-delay: 0s;">‚ö°</div>
      <div class="emoji-particle" style="left: 20%; animation-delay: 2s;">‚ú®</div>
      <div class="emoji-particle" style="left: 30%; animation-delay: 4s;">üî•</div>
      <div class="emoji-particle" style="left: 40%; animation-delay: 1s;">üí´</div>
      <div class="emoji-particle" style="left: 50%; animation-delay: 3s;">‚≠ê</div>
      <div class="emoji-particle" style="left: 60%; animation-delay: 5s;">‚úñÔ∏è</div>
      <div class="emoji-particle" style="left: 70%; animation-delay: 2.5s;">‚ûï</div>
      <div class="emoji-particle" style="left: 80%; animation-delay: 4.5s;">‚ûó</div>
      <div class="emoji-particle" style="left: 90%; animation-delay: 1.5s;">üéØ</div>
      <div class="emoji-particle" style="left: 15%; animation-delay: 3.5s;">üí°</div>
      <div class="emoji-particle" style="left: 85%; animation-delay: 0.5s;">üåü</div>
      <div class="emoji-particle" style="left: 25%; animation-delay: 5.5s;">‚ö°</div>
    </div>

    <!-- Sparkles -->
    <div class="pointer-events-none absolute inset-0 overflow-hidden">
      <div class="sparkle sparkle-1"></div>
      <div class="sparkle sparkle-2"></div>
      <div class="sparkle sparkle-3"></div>
      <div class="sparkle sparkle-4"></div>
      <div class="sparkle sparkle-5"></div>
      <div class="sparkle sparkle-6"></div>
    </div>

    <!-- Radial gradient glow -->
    <div
      class="pointer-events-none absolute inset-0"
      style="background: radial-gradient(circle at 50% 40%, rgba(241, 196, 15, 0.08) 0%, transparent 60%);"
    >
    </div>

    <div
      class="relative z-10 mx-auto max-w-4xl space-y-4 px-4 text-center sm:space-y-6 md:space-y-8"
    >
      <!-- Main Title -->
      <h1
        class="text-4xl leading-tight font-bold sm:text-5xl md:text-6xl lg:text-7xl"
        style="color: #f8fafc;"
      >
        Learn Math,<br />
        <span style="color: #f1c40f;">Catch Pok√©mon!</span>
      </h1>

      <!-- Pokemon Showcase -->
      <PokemonShowcase />

      <!-- Description -->
      <p
        class="mx-auto max-w-2xl px-2 text-base sm:text-lg md:text-xl lg:text-2xl"
        style="color: #cbd5e1;"
      >
        Master your math skills through exciting battles. Answer questions correctly to catch and
        collect Pok√©mon from Generation 1.
      </p>

      <!-- CTA Button -->
      <div class="flex justify-center">
        <SignInButton client:load />
      </div>
    </div>
  </section>

  <style>
    /* Animated grid pattern */
    .grid-pattern {
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(241, 196, 15, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(241, 196, 15, 0.05) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }

    @keyframes gridMove {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(50px, 50px);
      }
    }

    /* Light beams - subtle */
    .light-beam {
      position: absolute;
      width: 1px;
      height: 100%;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(241, 196, 15, 0.08) 50%,
        transparent 100%
      );
      filter: blur(8px);
      animation: beamMove linear infinite;
    }

    .beam-1 {
      left: 20%;
      animation-duration: 8s;
      animation-delay: 0s;
    }

    .beam-2 {
      left: 50%;
      animation-duration: 12s;
      animation-delay: -4s;
    }

    .beam-3 {
      left: 80%;
      animation-duration: 10s;
      animation-delay: -2s;
    }

    @keyframes beamMove {
      0% {
        transform: translateY(-100%) scaleY(0.5);
        opacity: 0;
      }
      50% {
        opacity: 0.15;
      }
      100% {
        transform: translateY(100%) scaleY(1.5);
        opacity: 0;
      }
    }

    /* Floating orbs with glow */
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.2;
      animation: floatOrb ease-in-out infinite;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(241, 196, 15, 0.6) 0%, transparent 70%);
      left: -200px;
      top: 20%;
      animation-duration: 15s;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(241, 196, 15, 0.5) 0%, transparent 70%);
      right: -250px;
      top: 50%;
      animation-duration: 20s;
      animation-delay: -5s;
    }

    .orb-3 {
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, rgba(241, 196, 15, 0.4) 0%, transparent 70%);
      left: 50%;
      bottom: 10%;
      animation-duration: 18s;
      animation-delay: -10s;
    }

    @keyframes floatOrb {
      0%,
      100% {
        transform: translate(0, 0) scale(1);
      }
      33% {
        transform: translate(50px, -40px) scale(1.15);
      }
      66% {
        transform: translate(-30px, 30px) scale(0.85);
      }
    }

    /* Floating emoji particles */
    .emoji-particle {
      position: absolute;
      font-size: 2rem;
      opacity: 0;
      animation: floatEmoji 15s ease-in-out infinite;
      text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }

    @keyframes floatEmoji {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg) scale(0.5);
        opacity: 0;
      }
      10% {
        opacity: 0.6;
      }
      50% {
        opacity: 0.8;
        transform: translateY(50vh) translateX(20px) rotate(180deg) scale(1);
      }
      90% {
        opacity: 0.6;
      }
      100% {
        transform: translateY(-20vh) translateX(-20px) rotate(360deg) scale(0.5);
        opacity: 0;
      }
    }

    /* Sparkle effects */
    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #f1c40f;
      border-radius: 50%;
      box-shadow:
        0 0 10px #f1c40f,
        0 0 20px #f1c40f,
        0 0 30px #f1c40f;
      animation: sparkleAnimation ease-in-out infinite;
    }

    .sparkle-1 {
      left: 15%;
      top: 15%;
      animation-duration: 3s;
      animation-delay: 0s;
    }

    .sparkle-2 {
      left: 85%;
      top: 25%;
      animation-duration: 4s;
      animation-delay: 1s;
    }

    .sparkle-3 {
      left: 30%;
      top: 70%;
      animation-duration: 3.5s;
      animation-delay: 2s;
    }

    .sparkle-4 {
      left: 70%;
      top: 60%;
      animation-duration: 4.5s;
      animation-delay: 0.5s;
    }

    .sparkle-5 {
      left: 50%;
      top: 20%;
      animation-duration: 3.8s;
      animation-delay: 1.5s;
    }

    .sparkle-6 {
      left: 90%;
      top: 80%;
      animation-duration: 4.2s;
      animation-delay: 2.5s;
    }

    @keyframes sparkleAnimation {
      0%,
      100% {
        opacity: 0;
        transform: scale(0);
      }
      50% {
        opacity: 1;
        transform: scale(1.5);
      }
    }

    /* Add pulse to sparkles */
    .sparkle::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: #f1c40f;
      border-radius: 50%;
      filter: blur(4px);
      opacity: 0.6;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%,
      100% {
        transform: scale(1);
        opacity: 0.6;
      }
      50% {
        transform: scale(1.5);
        opacity: 0.3;
      }
    }

    /* Disable animations for reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .grid-pattern,
      .light-beam,
      .orb,
      .emoji-particle,
      .sparkle {
        animation: none;
        opacity: 0.1;
      }
    }
  </style>

  <!-- Footer -->
  <Footer />
</PublicLayout>
