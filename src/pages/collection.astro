---
import PrivateLayout from '../layouts/PrivateLayout.astro';
import CollectionView from '@/components/collection/CollectionView';
import { collectionQuerySchema } from '@/lib/validation/collection.schema';
import { filtersFromQueryInput } from '@/components/collection/filter-utils';
import { COLLECTION_DEFAULT_FILTERS } from '@/components/collection/types';

const url = Astro.url;
const rawQuery = Object.fromEntries(url.searchParams.entries());
const parsed = collectionQuerySchema.safeParse(rawQuery);

const initialFilters = parsed.success
  ? filtersFromQueryInput(parsed.data)
  : COLLECTION_DEFAULT_FILTERS;
---

<PrivateLayout
  title="Collection - PokéMath"
  description="Browse your captured Pokémon, track shiny variants, and filter your Pokédex progress."
>
  <div class="container mx-auto max-w-7xl px-4 py-8">
    <CollectionView client:load initialFilters={initialFilters} />
  </div>
</PrivateLayout>
